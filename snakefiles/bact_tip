localrules: all

#imports
import pandas as pd, os

#read sample sheet
os.chdir(config['home_dir'])
sample_sheet = pd.read_csv(f"{config['output_directory']}sample_sheet.csv")

#move input files to data folder
os.makedirs(config['work_dir'], exist_ok = True)
for sample_id, ctg, r1, r2, taxonomy in zip(sample_sheet['sample_id'], sample_sheet["fa"],sample_sheet['fq1'],sample_sheet['fq2'], sample_sheet['taxonomy']):
    os.system(f"mv -n {ctg} {config['work_dir']}")
    if taxonomy in ["Legionella pneumophila","Mycobacterium tuberculosis"]:
        os.system(f"mv -n $(realpath $(basename {ctg}))/{sample_id}_bact_reads_classified_1.fastq.gz {config['work_dir']}")
        os.system(f"mv -n $(realpath $(basename {ctg}))/{sample_id}_bact_reads_classified_2.fastq.gz {config['work_dir']}")

#define sample_id_pattern wildcard
sip_wild = config['work_dir']+'{sample_id_pattern}_contigs.fasta'

#AGGREGATION RULE
rule all:
    input: 
        config['shell_target_files']
    run:
        data_contents = os.listdir(config['work_dir'])
        for idx, id in enumerate(sample_sheet["sample_id"]):
            for file in data_contents:
                if id in file:
                    os.system(f"mv {config['work_dir']}{file} {os.path.dirname(sample_sheet['fa'][idx])}")


rule hicap_hinfluenzae:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule meningotype_nmeningitidis:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule legsta_lpneumophila:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule lpgenomics_lpneumophila:
    input:
        read_1 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_1.fastq.gz',
        read_2 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_2.fastq.gz'
    output:
    run:


rule mtbseq_mtuberculosis:
    input:
        read_1 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_1.fastq.gz',
        read_2 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_2.fastq.gz'
    output:
    run:
    

rule kleborate_kpneumoniae:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:
    

rule kaptive_kpneumoniae:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:

    
rule argvate_saureus:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:
    

rule spatyper_saureus:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:

    
rule sccmec_saureus:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:
    

rule emmtyper_spyogenes:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule seqsero_senterica:
    input:
        read_1 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_1.fastq.gz',
        read_2 = config['output_directory']+'{sample_id_pattern}_bact_reads_classified_2.fastq.gz'
    output:
    run:


rule sistr_senterica:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule pasteur_lmonocytogenes:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run:


rule publmst_ngonorrhoe:
    input:
        contigs = config['work_dir']+'{sample_id_pattern}_contigs.fasta'
    output:
    run: